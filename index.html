<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ˆë“± ë¬¸í•´ë ¥ í•™ìŠµ - ì—­ì‚¬ë¥¼ í’ˆì€ ê¸°ì™€, ê²½ë³µì´</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* [ê¸°ë³¸ ì„¤ì •] */
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { 
            margin: 0; padding: 0; 
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif; 
            background-color: white; 
            /* [ìˆ˜ì •] ëª¨ë°”ì¼ ë¸Œë¼ìš°ì € ì£¼ì†Œì°½ ëŒ€ì‘ì„ ìœ„í•´ dvh ë‹¨ìœ„ ì‚¬ìš© (ì§€ì› ì•ˆí•˜ëŠ” ë¸Œë¼ìš°ì €ë¥¼ ìœ„í•´ vh ë³‘ê¸°) */
            height: 100vh; 
            height: 100dvh; 
            overflow: hidden; 
        }
        
        #app-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* [í—¤ë” & íƒ­] */
        header {
            height: 60px;
            border-bottom: 3px solid #3b82f6;
            display: flex;
            align-items: center;
            padding: 0 30px;
            justify-content: space-between;
            background: white;
            z-index: 10;
            flex-shrink: 0;
        }
        .logo { font-size: 24px; font-weight: bold; color: #374151; }
        .logo span { color: #2563eb; }
        .file-info { color: #9ca3af; font-size: 14px; }

        .tabs {
            display: flex;
            background-color: #f3f4f6;
            padding: 10px 30px 0;
            border-bottom: 1px solid #e5e7eb;
            gap: 5px;
            flex-shrink: 0;
        }
        .tab-btn {
            padding: 12px 25px;
            border-radius: 12px 12px 0 0;
            border: none;
            cursor: pointer;
            font-weight: bold;
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0.7;
            transition: all 0.2s;
            transform: translateY(5px);
            font-size: 16px;
        }
        .tab-btn.active { opacity: 1; transform: translateY(0); box-shadow: 0 -2px 5px rgba(0,0,0,0.05); }
        .tab-vocab { background-color: #9333ea; }
        .tab-read { background-color: #3b82f6; }
        .tab-structure { background-color: #1d4ed8; }
        .tab-write { background-color: #4f46e5; }

        /* [ì½˜í…ì¸  ê³µí†µ] */
        .content-area {
            flex-grow: 1;
            position: relative;
            /* [ìˆ˜ì •] ë‚´ìš©ì´ ë„˜ì¹˜ë©´ ìŠ¤í¬ë¡¤ì´ ìƒê¸°ë„ë¡ ë³€ê²½ (ì˜ë¦¼ ë°©ì§€) */
            overflow-y: auto; 
            overflow-x: hidden;
            background-color: #fff;
            display: flex;
            flex-direction: column;
            /* [ìˆ˜ì •] í•˜ë‹¨ ë‚´ë¹„ê²Œì´ì…˜ ë²„íŠ¼ì— ê°€ë ¤ì§€ì§€ ì•Šë„ë¡ ì—¬ë°± ì¶”ê°€ */
            padding-bottom: 100px; 
        }
        .screen {
            display: none; 
            width: 100%;
            /* height: 100%; [ì‚­ì œ] ìŠ¤í¬ë¡¤ì„ ìœ„í•´ ë†’ì´ ê°•ì œ ì œê±° */
            min-height: 100%; /* ìµœì†Œ ë†’ì´ë§Œ 100%ë¡œ ì„¤ì • */
            position: relative; /* absoluteì—ì„œ relativeë¡œ ë³€ê²½í•˜ì—¬ ìŠ¤í¬ë¡¤ íë¦„ì— ë”°ë¦„ */
            animation: fadeIn 0.3s ease-out;
            flex-direction: column; 
        }
        .screen.active { display: flex; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-5px); }
            40% { transform: translateX(5px); }
            60% { transform: translateX(-5px); }
            80% { transform: translateX(5px); }
        }

        .center-wrapper {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            /* height: 100%; [ì‚­ì œ] ë†’ì´ ìœ ë™ì ìœ¼ë¡œ ë³€ê²½ */
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .instruction-banner {
            background-color: #16a34a;
            color: white;
            padding: 15px 30px;
            margin: 20px 30px 10px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            font-size: 18px;
            flex-shrink: 0;
        }
        .step-badge {
            background-color: #ef4444;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 16px;
        }
        .sub-badge {
            background-color: rgba(255,255,255,0.2);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-left: auto;
        }

        /* [í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜] */
        .nav-controls {
            position: absolute;
            bottom: 30px;
            left: 30px;
            right: 30px;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
            z-index: 50;
        }
        .nav-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #facc15;
            border: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            cursor: pointer;
            pointer-events: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.2s;
        }
        .nav-btn:hover { transform: scale(1.1); background-color: #fbbf24; }
        .nav-btn:disabled {
            background-color: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* [í˜ì´ì§€ í‘œì‹œ ì ] */
        .dots-indicator {
            background: transparent; 
            padding: 10px 25px;
            border-radius: 30px;
            display: flex;
            gap: 12px; 
            border: none; 
            pointer-events: auto;
            align-items: center;
            box-shadow: none; 
        }
        .dot { 
            width: 14px; height: 14px; 
            border-radius: 50%; 
            background-color: #d1d5db; 
            transition: background-color 0.3s; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        }
        .dot.active { 
            background-color: #ef4444; 
        }

        /* [í™”ë©´ ìŠ¤íƒ€ì¼: ì¸íŠ¸ë¡œ] */
        .intro-bg { 
            background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%); 
            justify-content: center; 
            align-items: center; 
            /* ì¸íŠ¸ë¡œ í™”ë©´ì€ ê½‰ ì°¨ê²Œ */
            position: absolute; 
            top: 0; left: 0; height: 100%;
        }
        .book-cover { width: 600px; height: 420px; background-color: #1e293b; border-radius: 15px; position: relative; box-shadow: 0 30px 60px rgba(0,0,0,0.3); margin: 50px 0; overflow: hidden; border: 10px solid #475569; }
        .book-title { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 48px; font-weight: bold; text-align: center; text-shadow: 0 4px 8px rgba(0,0,0,0.5); width: 100%; line-height: 1.3; }
        .start-btn { background-color: #2563eb; color: white; font-size: 28px; font-weight: bold; padding: 20px 80px; border-radius: 60px; border: none; cursor: pointer; box-shadow: 0 15px 30px rgba(37, 99, 235, 0.4); transition: transform 0.2s; }
        .start-btn:hover { transform: scale(1.05); background-color: #1d4ed8; }

        /* [í™”ë©´ ìŠ¤íƒ€ì¼: ì•„ì›ƒíŠ¸ë¡œ] */
        .outro-bg {
            background: linear-gradient(135deg, #dbeafe 0%, #eff6ff 100%);
            justify-content: center; 
            align-items: center;
            text-align: center;
            /* ì•„ì›ƒíŠ¸ë¡œ í™”ë©´ë„ ê½‰ ì°¨ê²Œ */
            position: absolute; 
            top: 0; left: 0; height: 100%;
        }
        .outro-icon { font-size: 100px; margin-bottom: 20px; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-30px);} 60% {transform: translateY(-15px);} }
        .outro-title { font-size: 48px; font-weight: 900; color: #1e40af; margin-bottom: 20px; }
        .outro-desc { font-size: 24px; color: #374151; margin-bottom: 50px; }
        .replay-btn {
            background-color: #f59e0b; color: white;
            font-size: 24px; font-weight: bold;
            padding: 15px 50px; border-radius: 40px;
            border: none; cursor: pointer;
            box-shadow: 0 10px 20px rgba(245, 158, 11, 0.3);
            transition: transform 0.2s;
            display: flex; align-items: center; gap: 10px;
        }
        .replay-btn:hover { transform: scale(1.05); }

        /* [ì–´íœ˜ë‘] */
        .vocab-container { 
            padding: 0 40px; 
            flex-grow: 1; 
            display: flex; align-items: center; justify-content: center; 
            gap: 20px; 
        }
        
        /* ë³„ì  ì˜ì—­ */
        .star-rating-area {
            width: 100%; max-width: 900px; margin: 0 auto 5px;
            display: flex; justify-content: flex-end; gap: 5px;
        }
        .star-icon { color: #d1d5db; fill: #d1d5db; transition: all 0.3s ease; } 
        .star-icon.active { color: #facc15; fill: #facc15; } 

        /* ì–´íœ˜ë‘ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .vocab-card { 
            background: white; 
            border: 5px solid #fde047; 
            border-radius: 40px; 
            padding: 30px 50px; /* ë‚´ë¶€ ì—¬ë°± */
            width: 100%; 
            max-width: 900px; /* ì¹´ë“œ í¬ê¸° */
            box-shadow: 0 20px 40px rgba(0,0,0,0.08); 
            display: flex; 
            flex-direction: column; 
            position: relative;
            min-height: 550px; 
            margin-bottom: 30px; /* ì¹´ë“œ ì•„ë˜ ì—¬ë°± ì¶”ê°€ */
        }
        
        .vocab-arrow-btn {
            background: #3b82f6; border: none; cursor: pointer; color: white;
            transition: transform 0.2s;
            padding: 15px; border-radius: 50%; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex; align-items: center; justify-content: center;
            flex-shrink: 0; 
        }
        .vocab-arrow-btn:hover { transform: scale(1.1); }
        .vocab-arrow-btn:disabled { background: #e5e7eb; color: #9ca3af; cursor: not-allowed; transform: none; box-shadow: none; }

        .vocab-main-title {
            text-align: center; font-size: 80px; font-weight: 900; color: #1f2937; margin-bottom: 10px;
        }

        .hanja-box { 
            background: transparent; padding: 10px; 
            display: flex; justify-content: center; align-items: center; 
            gap: 20px; margin-bottom: 30px; 
        }
        .hanja-item { display: flex; align-items: center; gap: 10px; font-size: 32px; color: #4b5563; }
        .hanja-reveal { 
            background-color: #3b82f6; color: white; padding: 5px 20px; 
            border-radius: 10px; cursor: pointer; transition: 0.3s; 
            min-width: 80px; text-align: center; font-size: 20px; 
        }
        .hanja-reveal.revealed { background-color: #dbeafe; color: #1e40af; font-weight: bold; }

        .vocab-bottom-layout {
            display: flex; gap: 40px; 
            border: 3px dashed #fdba74; 
            border-radius: 20px; 
            padding: 30px;
            background-color: #fff7ed;
            align-items: center;
            flex-grow: 1; /* ë†’ì´ ì±„ìš°ê¸° */
        }
        
        /* ì´ë¯¸ì§€ í”Œë ˆì´ìŠ¤í™€ë” */
        .vocab-img-placeholder {
            width: 300px; height: 220px; 
            background: white; 
            border-radius: 15px;
            border: 2px solid #fed7aa; 
            display: flex; justify-content: center; align-items: center;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        /* í…ìŠ¤íŠ¸ ì˜ì—­ */
        .vocab-text-area {
            flex-grow: 1; 
            display: flex; 
            flex-direction: column; 
            gap: 25px; 
            justify-content: center;
        }
        .vocab-row { display: flex; align-items: flex-start; gap: 20px; }
        .vocab-label {
            background-color: #3b82f6; /* íŒŒë€ìƒ‰ */
            color: white; 
            padding: 8px 0; 
            border-radius: 10px; 
            font-weight: bold; font-size: 20px; 
            width: 80px; 
            text-align: center;
            flex-shrink: 0;
            margin-top: 5px; /* ì¤„ë§ì¶¤ */
        }
        .vocab-label.ex { background-color: #374151; /* ì˜ˆë¬¸ì€ ì§™ì€ íšŒìƒ‰ */ }
        
        .vocab-desc { 
            font-size: 24px; color: #374151; font-weight: 500; line-height: 1.5; 
            display: flex; align-items: center; flex-wrap: wrap; gap: 10px;
        }
        .highlight-word { color: #2563eb; font-weight: 900; }
        .highlight-yellow { background-color: #fef08a; padding: 0 5px; border-radius: 4px; }
        .speaker-icon { cursor: pointer; color: #ea580c; transition: color 0.2s; } /* ì£¼í™©ìƒ‰ ìŠ¤í”¼ì»¤ */
        .speaker-icon:hover { color: #c2410c; }

        /* ë‹¤ìŒ ë‹¨ì–´ í™”ì‚´í‘œ (ì¹´ë“œ ë‚´ë¶€ ì˜¤ë¥¸ìª½) */
        .vocab-next-arrow {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: #3b82f6;
            transition: transform 0.2s;
            z-index: 10;
        }
        .vocab-next-arrow:hover { transform: translateY(-50%) scale(1.2); }


        /* ê²Œì„ */
        .game-bg { background-color: #ecfeff; padding: 20px 20px 100px; display: flex; flex-direction: column; align-items: center; justify-content: center; flex-grow: 1; }
        .claw-machine { width: 800px; height: 600px; background: linear-gradient(to bottom, #60a5fa, #3b82f6); border-radius: 30px 30px 0 0; border: 6px solid #1d4ed8; position: relative; display: flex; flex-direction: column; margin-bottom: 50px; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
        .machine-window { background: rgba(255,255,255,0.3); flex-grow: 1; margin: 30px; border-radius: 20px; border: 3px solid rgba(255,255,255,0.6); position: relative; overflow: hidden; }
        .claw-arm { width: 12px; height: 80px; background: #94a3b8; position: absolute; top: 0; left: 50%; transform: translateX(-50%); transition: height 1s; z-index: 5; }
        .claw-hand { width: 50px; height: 40px; border: 5px solid #94a3b8; border-top: none; border-radius: 0 0 25px 25px; position: absolute; bottom: -40px; left: -19px; }
        .dolls-area { position: absolute; bottom: 20px; width: 100%; display: flex; justify-content: space-around; }
        .doll-btn { background: none; border: none; cursor: pointer; display: flex; flex-direction: column; align-items: center; transition: transform 0.2s; }
        .doll-btn:hover { transform: translateY(-10px); }
        .doll-icon { font-size: 70px; filter: drop-shadow(0 5px 3px rgba(0,0,0,0.2)); }
        .doll-label { background: white; padding: 6px 15px; border-radius: 15px; font-weight: bold; margin-top: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); font-size: 18px; color: #333;}
        .quiz-board { background: white; border: 4px solid #bfdbfe; border-radius: 50px; padding: 15px 40px; position: absolute; top: 40px; left: 50%; transform: translateX(-50%); font-size: 26px; font-weight: bold; color: #1e3a8a; z-index: 10; width: 80%; text-align: center; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .quiz-blank { display: inline-block; width: 80px; height: 40px; background: #e2e8f0; border-radius: 10px; vertical-align: middle; margin: 0 8px; text-align: center; line-height: 40px; color: #2563eb; }

        /* ì½ê¸°ë‘ */
        .reading-layout { padding: 0 40px 40px; height: calc(100% - 100px); display: flex; justify-content: center; }
        .text-container { width: 100%; max-width: 1200px; background: white; border-radius: 20px; border: 1px solid #e5e7eb; padding: 40px 50px; overflow-y: auto; line-height: 2.2; font-size: 20px; color: #374151; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); position: relative; }
        .text-container::-webkit-scrollbar { width: 10px; }
        .text-container::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 5px; }
        .passage-image-wrapper { float: right; width: 350px; margin: 0 0 20px 40px; position: relative; z-index: 10; }
        
        .passage-image { 
            width: 100%; height: auto; border-radius: 20px; 
            object-fit: cover; 
        }
        
        .read-done-btn { display: block; margin: 50px auto 0; background-color: #2563eb; color: white; border: none; padding: 15px 40px; border-radius: 40px; font-size: 20px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(37, 99, 235, 0.3); transition: 0.2s; clear: both; }
        .read-done-btn:hover { background-color: #1d4ed8; transform: translateY(-2px); }
        .key-sentence-bar { position: absolute; bottom: 0; left: 0; width: 100%; background: white; border-top: 3px solid #e5e7eb; padding: 30px 30px 100px; transform: translateY(100%); transition: transform 0.5s ease-out; display: flex; align-items: center; gap: 20px; box-shadow: 0 -10px 30px rgba(0,0,0,0.1); justify-content: center; z-index: 20; }
        .key-sentence-bar.show { transform: translateY(0); }
        .key-icon { background: #fef08a; padding: 15px; border-radius: 50%; color: #854d0e; }

        /* í€´ì¦ˆ */
        .quiz-container { display: flex; gap: 30px; padding: 0 40px 120px; height: calc(100% - 100px); }
        .passage-preview { width: 30%; background: #f9fafb; padding: 30px; border-radius: 20px; overflow-y: auto; font-size: 16px; line-height: 1.8; color: #6b7280; border: 1px solid #e5e7eb; }
        .question-area { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .question-box { background: white; padding: 40px; border-radius: 30px; border: 3px solid #dbeafe; box-shadow: 0 10px 20px rgba(0,0,0,0.05); flex-grow: 1; display: flex; flex-direction: column; overflow-y: auto; }
        .q-tag { background: #2563eb; color: white; display: inline-block; padding: 8px 20px; border-radius: 20px; font-size: 16px; font-weight: bold; align-self: flex-start; margin-bottom: 20px; flex-shrink: 0; }
        .q-text { font-size: 26px; font-weight: bold; margin-bottom: 30px; color: #1f2937; line-height: 1.4; flex-shrink: 0; }
        .option-list { display: flex; flex-direction: column; gap: 15px; flex-grow: 0; }
        .option-item { padding: 20px; border: 2px solid #e5e7eb; border-radius: 15px; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 15px; font-size: 20px; }
        .option-item:hover { background: #f3f4f6; border-color: #cbd5e1; }
        .option-item.selected { border-color: #2563eb; background: #eff6ff; color: #1e40af; font-weight: bold; }
        .option-item.correct { border-color: #16a34a; background: #dcfce7; color: #166534; }
        .option-item.wrong { border-color: #ef4444; background: #fee2e2; color: #991b1b; animation: shake 0.5s ease-in-out; }
        .explanation-box { background: #eff6ff; padding: 25px; border-radius: 15px; margin-top: 30px; border: 2px solid #bfdbfe; display: none; font-size: 18px; line-height: 1.6; }
        .explanation-box.show { display: block; animation: fadeIn 0.3s; }

        /* êµ¬ì¡°ë‘ */
        .structure-layout { padding: 0 40px 120px; height: calc(100% - 100px); display: flex; flex-direction: column; gap: 30px; }
        .structure-intro-bg { background-color: #ffadad; padding: 40px; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; position: relative; }
        .structure-title-banner { background: #a855f7; color: white; padding: 15px 40px; border-radius: 30px; font-size: 20px; font-weight: bold; margin-bottom: 40px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .structure-card { background: white; border: 5px solid #374151; border-radius: 40px; padding: 50px 80px; text-align: left; position: relative; max-width: 800px; width: 100%; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .structure-card-header { position: absolute; top: -25px; left: 50%; transform: translateX(-50%); background: #374151; color: #facc15; padding: 10px 30px; border-radius: 25px; font-weight: bold; font-size: 18px; display: flex; align-items: center; gap: 10px; }
        .structure-main-title { font-size: 48px; font-weight: 900; color: #1e3a8a; margin: 30px 0 40px; text-align: center; }
        .structure-list { display: flex; flex-direction: column; gap: 20px; }
        .structure-item { display: flex; align-items: center; gap: 15px; font-size: 22px; color: #374151; }
        .structure-badge { background: #f97316; color: white; padding: 5px 15px; border-radius: 15px; font-size: 16px; font-weight: bold; }
        .structure-start-btn { margin-top: 50px; background: #2563eb; color: white; padding: 15px 60px; border-radius: 30px; font-size: 24px; font-weight: bold; border: none; cursor: pointer; box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3); transition: transform 0.2s; }
        .structure-start-btn:hover { transform: scale(1.05); }
        .concept-row { display: flex; gap: 20px; height: 200px; }
        .concept-label { width: 200px; background: #e5e7eb; border-radius: 20px; display: flex; justify-content: center; align-items: center; font-size: 28px; font-weight: bold; color: #4b5563; }
        .concept-card { flex: 1; border: 3px dashed #fdba74; border-radius: 20px; display: flex; justify-content: center; align-items: center; cursor: pointer; position: relative; background: #fff7ed; transition: 0.3s; }
        .concept-card:hover { background: #ffedd5; }
        .concept-card.active { background: #fff; border-style: solid; border-color: #f97316; }
        .concept-hidden { display: none; text-align: center; }
        .concept-card.active .concept-hidden { display: block; animation: fadeIn 0.3s; }
        .concept-card.active .concept-placeholder { display: none; }
        .compare-table { display: flex; flex-direction: column; gap: 15px; flex-grow: 1; }
        .compare-row { display: flex; height: 100px; }
        .compare-header { width: 150px; background: #e5e7eb; display: flex; justify-content: center; align-items: center; font-weight: bold; border-radius: 15px 0 0 15px; font-size: 20px; color: #374151; }
        .compare-cell { flex: 1; display: flex; justify-content: center; align-items: center; border: 2px solid white; position: relative; font-size: 18px; font-weight: bold; color: #1f2937; }
        .bg-orange { background-color: #ffedd5; }
        .bg-yellow { background-color: #fef9c3; border-radius: 0 15px 15px 0; }
        .dropdown-btn { width: 100%; height: 100%; border: none; background: transparent; cursor: pointer; font-size: 24px; color: #9ca3af; font-weight: bold; }
        .dropdown-btn.correct { color: #2563eb; }
        .dropdown-menu { position: absolute; top: 80%; left: 0; width: 100%; background: white; border: 2px solid #e5e7eb; border-radius: 10px; z-index: 20; box-shadow: 0 10px 20px rgba(0,0,0,0.1); display: none; max-height: 200px; overflow-y: auto; }
        .dropdown-menu.show { display: block; }
        .dropdown-item { padding: 15px; border-bottom: 1px solid #f3f4f6; cursor: pointer; font-size: 16px; font-weight: normal; }
        .dropdown-item:hover { background: #f9fafb; color: #2563eb; }
        .selectable-text { font-size: 22px; line-height: 2.2; color: #374151; }
        .sentence { padding: 5px 10px; border-radius: 5px; cursor: pointer; transition: 0.2s; }
        .sentence:hover { background-color: #eff6ff; }
        .sentence.selected-correct { background-color: #dcfce7; border: 2px solid #16a34a; color: #166534; }
        .sentence.selected-wrong { background-color: #fee2e2; border: 2px solid #ef4444; color: #991b1b; }

        /* [ì“°ê¸°ë‘ - ë””ìì¸ ìˆ˜ì •] */
        .writing-container { 
            padding: 0 40px; height: 100%; position: relative; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        /* ë…¸ë€ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ (ì–´íœ˜ë‘ ì¹´ë“œì™€ í†µì¼) */
        .writing-card {
            background: white;
            border: 5px solid #fde047;
            border-radius: 40px;
            padding: 50px;
            width: 100%; max-width: 1000px;
            height: 80%; max-height: 600px; /* ë†’ì´ ì¡°ì • */
            margin-bottom: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        /* ìƒë‹¨ ë²„íŠ¼ ì˜ì—­ (ë°•ìŠ¤ ë°”ê¹¥ ìš°ì¸¡ ìƒë‹¨) */
        .writing-top-buttons {
            width: 100%; max-width: 1000px;
            display: flex; justify-content: flex-end; gap: 15px;
            margin-bottom: 15px;
        }

        /* ì›í˜• ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .circle-btn {
            width: 60px; height: 60px; border-radius: 50%;
            border: none; cursor: pointer;
            display: flex; justify-content: center; align-items: center;
            color: white; font-weight: bold; font-size: 14px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .circle-btn:hover { transform: scale(1.1); }
        .circle-btn.orange { background-color: #f97316; }
        .circle-btn.green { background-color: #84cc16; }
        
        .writing-input {
            flex-grow: 1;
            border: none;
            font-size: 24px;
            line-height: 1.8;
            color: #374151;
            outline: none;
            resize: none;
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif; 
        }
        .writing-input::placeholder { color: #d1d5db; font-weight: normal; }
        .writing-input:focus::placeholder { color: transparent; }

        /* ë‹¤í–ˆì–´ìš” ë²„íŠ¼ ì»¨í…Œì´ë„ˆ (ê³µí†µ - ìˆ˜ì •ë¨: ì ˆëŒ€ ìœ„ì¹˜ë¡œ ë³€ê²½í•˜ì—¬ ì¹´ë“œ ë°€ë¦¼ ë°©ì§€) */
        .done-btn-container {
            display: flex; justify-content: center; 
            /* í™”ë©´ í•˜ë‹¨ì— ê³ ì • */
            position: absolute;
            bottom: 100px; /* ë„¤ë¹„ê²Œì´ì…˜ ìœ„ì— ìœ„ì¹˜ */
            left: 0;
            right: 0;
            width: 100%;
            pointer-events: none; /* ì»¨í…Œì´ë„ˆ ìì²´ëŠ” í´ë¦­ í†µê³¼ */
        }
        
        /* ì“°ê¸°ë‘ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ì–´íœ˜ë‘ì—ë„ ì ìš©) */
        .writing-done-btn {
            background-color: #2563eb; color: white;
            font-size: 24px; font-weight: bold;
            padding: 15px 60px; border-radius: 50px;
            border: none; cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3);
            pointer-events: auto; /* ë²„íŠ¼ì€ í´ë¦­ ê°€ëŠ¥ */
        }
        .writing-done-btn:disabled {
            background-color: #e5e7eb; color: #9ca3af;
            cursor: not-allowed; box-shadow: none;
        }
        .writing-done-btn:not(:disabled):hover {
            transform: scale(1.05); background-color: #1d4ed8;
        }

        /* íŒì—… ëª¨ë‹¬ */
        .modal-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; display: none; justify-content: center; align-items: center; }
        .modal-overlay.active { display: flex; }
        .modal-box { background: white; width: 700px; max-height: 80%; padding: 40px; border-radius: 25px; overflow-y: auto; position: relative; box-shadow: 0 25px 50px rgba(0,0,0,0.25); }
        .close-modal { position: absolute; top: 20px; right: 20px; background: none; border: none; font-size: 30px; cursor: pointer; color: #9ca3af; }

    </style>
</head>
<body>

<div id="app-container">
    <header>
        <div class="logo"><span>ë©”ê°€ìŠ¤í„°ë””</span> ì´ˆë“± ë¬¸í•´ë ¥</div>
        <div class="file-info">íŒŒì¼: 4ê°œì›” 2ì£¼ì°¨_ë¬¸í™”ìœ ì‚°</div>
    </header>

    <div class="tabs">
        <button class="tab-btn tab-vocab" onclick="goToTab('vocab')">
            <i data-lucide="lightbulb" size="18"></i> ì–´íœ˜ë‘
        </button>
        <button class="tab-btn tab-read" onclick="goToTab('read')">
            <i data-lucide="book-open" size="18"></i> ì½ê¸°ë‘
        </button>
        <button class="tab-btn tab-structure" onclick="goToTab('structure')">
            <i data-lucide="layout" size="18"></i> êµ¬ì¡°ë‘
        </button>
        <button class="tab-btn tab-write" onclick="goToTab('write')">
            <i data-lucide="pen-tool" size="18"></i> ì“°ê¸°ë‘
        </button>
    </div>

    <div class="content-area">
        
        <!-- 1. ì¸íŠ¸ë¡œ -->
        <div id="intro-screen" class="screen intro-bg active">
            <div style="font-size: 22px; color: #ea580c; font-weight: bold; margin-bottom: 15px;">[ì‘ìš©] 4ê°œì›” 2ì£¼ì°¨</div>
            <div class="book-cover">
                <div style="width:100%; height:100%; background: #334155; opacity: 0.8; display:flex; justify-content:center; align-items:center;">
                    <span style="font-size:80px;">ğŸ¯</span>
                </div>
                <div class="book-title">ì—­ì‚¬ë¥¼ í’ˆì€ ê¸°ì™€,<br>ê²½ë³µì´</div>
            </div>
            <button class="start-btn" onclick="startApp()">í•™ìŠµ ì‹œì‘í•˜ê¸°</button>
        </div>

        <!-- 2. ì–´íœ˜ë‘ -->
        <div id="vocab-screen" class="screen">
            <div id="vocab-step-1" class="vocab-step" style="height: 100%; display: flex; flex-direction: column;">
                <div class="center-wrapper">
                    <div class="instruction-banner">
                        <div class="step-badge">1</div>
                        <span>ë¹ˆì¹¸ì„ ëˆŒëŸ¬ ì´ë²ˆ ì‹œê°„ ì–´íœ˜ë¥¼ ì•Œì•„ë´…ì‹œë‹¤.</span>
                    </div>
                    
                    <!-- ë³„ì  ì˜ì—­ (ëŒ€ì§€ì‹œë¬¸ê³¼ ì¹´ë“œ ì‚¬ì´) -->
                    <div class="star-rating-area" id="vocab-star-rating">
                        <i data-lucide="star" class="star-icon" size="28"></i> 
                        <i data-lucide="star" class="star-icon" size="28"></i> 
                    </div>

                    <div class="vocab-container" id="vocab-cards-container">
                        
                        <!-- ì´ì „ ë²„íŠ¼ (ì²« ë²ˆì§¸ ì¹´ë“œì—ì„œëŠ” ìˆ¨ê¹€) -->
                        <button class="vocab-arrow-btn" id="prev-word-btn" onclick="prevVocabCard()" style="display: none; margin-right: -30px; z-index: 1;">
                            <i data-lucide="chevron-left" size="40"></i>
                        </button>

                        <!-- ì²« ë²ˆì§¸ ë‹¨ì–´ ì¹´ë“œ (ê°€ì¹˜) -->
                        <div class="vocab-card" id="vocab-card-1">
                            <button class="vocab-next-arrow" onclick="nextVocabCard()">
                                <i data-lucide="chevron-right" size="48"></i>
                            </button>

                            <div class="vocab-main-title">ê°€ì¹˜</div>
                            
                            <div class="hanja-box">
                                <div class="hanja-item"><span>åƒ¹</span><div class="hanja-reveal" onclick="reveal(this, 'ê°’ ê°€', 1)">?</div></div>
                                <div style="font-size: 32px; color: #9ca3af;">+</div>
                                <div class="hanja-item"><span>å€¤</span><div class="hanja-reveal" onclick="reveal(this, 'ê°’ ì¹˜', 1)">?</div></div>
                            </div>
                            
                            <!-- í•˜ë‹¨ ë ˆì´ì•„ì›ƒ: ì´ë¯¸ì§€ + í…ìŠ¤íŠ¸ -->
                            <div class="vocab-bottom-layout">
                                <!-- ì´ë¯¸ì§€ í”Œë ˆì´ìŠ¤í™€ë” (Wrapper) -->
                                <div class="vocab-img-placeholder">
                                    <!-- [ì‚¬ìš©ì ìˆ˜ì • ì˜ì—­] ì•„ë˜ img íƒœê·¸ì˜ src="..." ë¶€ë¶„ì„ ì‹¤ì œ ì´ë¯¸ì§€ ì£¼ì†Œë¡œ ë³€ê²½í•˜ì„¸ìš” -->
                                    <img src="https://placehold.co/250x180?text=Vocab+Image" style="width:100%; height:100%; object-fit:cover;" alt="ë‹¨ì–´ ì´ë¯¸ì§€">
                                </div>

                                <div class="vocab-text-area">
                                    <div class="vocab-row">
                                        <div class="vocab-label">ëœ»</div>
                                        <div class="vocab-desc">
                                            <span class="highlight-yellow">ì‚¬ë¬¼</span>ì´ ì§€ë‹ˆê³  ìˆëŠ” <span class="highlight-yellow">ì“¸ëª¨</span>.
                                            <i data-lucide="volume-2" class="speaker-icon" size="24" onclick="alert('ëœ» ì½ì–´ì£¼ê¸°')"></i>
                                        </div>
                                    </div>
                                    <div class="vocab-row">
                                        <div class="vocab-label ex">ì˜ˆë¬¸</div>
                                        <div class="vocab-desc">
                                            ì´ ê·¸ë¦¼ì€ ì—­ì‚¬ì  <span class="highlight-word">ê°€ì¹˜</span>ê°€ ë†’ë‹¤.
                                            <i data-lucide="volume-2" class="speaker-icon" size="24" onclick="alert('ì˜ˆë¬¸ ì½ì–´ì£¼ê¸°')"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ë‘ ë²ˆì§¸ ë‹¨ì–´ ì¹´ë“œ (ë³´ì¡´) -->
                        <div class="vocab-card" id="vocab-card-2" style="display: none;">
                            <div class="vocab-main-title">ë³´ì¡´</div>
                            
                            <div class="hanja-box">
                                <div class="hanja-item"><span>ä¿</span><div class="hanja-reveal" onclick="reveal(this, 'ì§€í‚¬ ë³´', 2)">?</div></div>
                                <div style="font-size: 32px; color: #9ca3af;">+</div>
                                <div class="hanja-item"><span>å­˜</span><div class="hanja-reveal" onclick="reveal(this, 'ìˆì„ ì¡´', 2)">?</div></div>
                            </div>
                            
                            <!-- í•˜ë‹¨ ë ˆì´ì•„ì›ƒ: ì´ë¯¸ì§€ + í…ìŠ¤íŠ¸ -->
                            <div class="vocab-bottom-layout">
                                <!-- ì´ë¯¸ì§€ í”Œë ˆì´ìŠ¤í™€ë” (Wrapper) -->
                                <div class="vocab-img-placeholder">
                                    <!-- [ì‚¬ìš©ì ìˆ˜ì • ì˜ì—­] ì•„ë˜ img íƒœê·¸ì˜ src="..." ë¶€ë¶„ì„ ì‹¤ì œ ì´ë¯¸ì§€ ì£¼ì†Œë¡œ ë³€ê²½í•˜ì„¸ìš” -->
                                    <img src="https://placehold.co/250x180?text=Vocab+Image" style="width:100%; height:100%; object-fit:cover;" alt="ë‹¨ì–´ ì´ë¯¸ì§€">
                                </div>

                                <div class="vocab-text-area">
                                    <div class="vocab-row">
                                        <div class="vocab-label">ëœ»</div>
                                        <div class="vocab-desc">
                                            <span class="highlight-yellow">ì˜ ë³´í˜¸í•˜ê³  ê°„ì§í•˜ì—¬</span> ë‚¨ê¹€.
                                            <i data-lucide="volume-2" class="speaker-icon" size="24" onclick="alert('ëœ» ì½ì–´ì£¼ê¸°')"></i>
                                        </div>
                                    </div>
                                    <div class="vocab-row">
                                        <div class="vocab-label ex">ì˜ˆë¬¸</div>
                                        <div class="vocab-desc">
                                            ë¬¸í™”ì¬ë¥¼ ì˜ <span class="highlight-word">ë³´ì¡´</span>í•´ì•¼ í•œë‹¤.
                                            <i data-lucide="volume-2" class="speaker-icon" size="24" onclick="alert('ì˜ˆë¬¸ ì½ì–´ì£¼ê¸°')"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ë‹¤ìŒ ë‹¨ì–´/ë‹¨ê³„ í™”ì‚´í‘œ ë²„íŠ¼ -->
                        <button class="vocab-arrow-btn" id="next-word-btn" onclick="nextVocabCard()" style="margin-left: -30px; z-index: 1;">
                            <i data-lucide="chevron-right" size="40"></i>
                        </button>

                    </div>
                    
                    <!-- [ìˆ˜ì •] ì–´íœ˜ë‘ 'ë‹¤í–ˆì–´ìš”' ë²„íŠ¼ ì˜ì—­ (ì¹´ë“œ ë°”ê¹¥) -->
                    <div id="vocab-done-container" class="done-btn-container" style="display:none;">
                        <button id="vocab-done-btn" class="writing-done-btn" disabled onclick="changeStep(1)">
                            ë‹¤ í–ˆì–´ìš”
                        </button>
                    </div>

                </div>
            </div>
            
            <div id="vocab-step-2" class="vocab-step" style="display:none; height: 100%; flex-direction: column;">
                <div class="center-wrapper">
                    <div class="instruction-banner">
                        <div class="step-badge">2</div>
                        <span>ë¹ˆì¹¸ì— ë“¤ì–´ê°ˆ ì–´íœ˜ë¥¼ ì°¾ì•„ ë¬¸ì¥ì„ ì™„ì„±í•´ ë´…ì‹œë‹¤.</span>
                    </div>
                    <div class="game-bg">
                        <div class="claw-machine">
                            <div class="quiz-board">ì´ ê·¸ë¦¼ì€ ì—­ì‚¬ì  <div class="quiz-blank">?</div> ì´/ê°€ ë†’ë‹¤.</div>
                            <div class="machine-window">
                                <div class="claw-arm" id="claw-arm"><div class="claw-hand"></div></div>
                                <div class="dolls-area">
                                    <button class="doll-btn" onclick="playGame(false)"><div class="doll-icon">ğŸ§¸</div><div class="doll-label">ë³´ì¡´</div></button>
                                    <button class="doll-btn" onclick="playGame(true)"><div class="doll-icon">ğŸ°</div><div class="doll-label">ê°€ì¹˜</div></button>
                                    <button class="doll-btn" onclick="playGame(false)"><div class="doll-icon">ğŸ¤–</div><div class="doll-label">ë¬¸í™”ìœ ì‚°</div></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. ì½ê¸°ë‘ -->
        <div id="read-screen" class="screen">
            <div class="center-wrapper">
                <div id="read-step-1" class="read-step" style="height: 100%; display: flex; flex-direction: column;">
                    <div class="instruction-banner">
                        <div class="step-badge">1</div>
                        <span>ê²½ë³µì´ì˜ ì˜ë¯¸ë¥¼ ìƒê°í•˜ë©° ã€Œì—­ì‚¬ë¥¼ í’ˆì€ ê¸°ì™€, ê²½ë³µì´ã€ë¥¼ ì½ì–´ ë´…ì‹œë‹¤.</span>
                    </div>
                    <div class="reading-layout">
                        <div class="text-container" id="passage-text">
                            <div style="display:flex; align-items:center; gap:15px; margin-bottom: 30px;">
                                <button style="border:none; background:#f97316; color:white; padding:8px 12px; border-radius:50%; cursor:pointer;">
                                    <i data-lucide="volume-2" size="24"></i>
                                </button>
                                <h2 style="margin:0; font-size: 32px;">ì—­ì‚¬ë¥¼ í’ˆì€ ê¸°ì™€, ê²½ë³µì´</h2>
                            </div>
                            
                            <div class="passage-image-wrapper">
                                <!-- [ì‚¬ìš©ì ìˆ˜ì • ì˜ì—­] ì•„ë˜ img íƒœê·¸ì˜ src="..." ë¶€ë¶„ì„ ì‹¤ì œ ì´ë¯¸ì§€ ì£¼ì†Œë¡œ ë³€ê²½í•˜ì„¸ìš” -->
                                <img src="https://placehold.co/400x300/e2e8f0/1e293b?text=Main+Image" 
                                     class="passage-image" 
                                     alt="ë³¸ë¬¸ ì´ë¯¸ì§€">
                            </div>

                            <p>ë¶ì•…ì‚° ì•„ë˜ ìë¦¬ ì¡ì€ ì¡°ì„ ì˜ ê¶ê¶, <strong style="color:#1d4ed8;">ê²½ë³µê¶</strong>ì€ ìˆ˜ë°± ë…„ ë™ì•ˆ ë°”ëŒê³¼ í–‡ì‚´ì„ ë§ìœ¼ë©° ì¡°ìš©íˆ ê·¸ ìë¦¬ë¥¼ ì§€ì¼œ ì™”ë‹¤. ê¶ê¶ì˜ ê¸°ì™€ë“¤ì€ ê°ì ìì‹ ì˜ ì´ì•¼ê¸°ë¥¼ í’ˆì€ ë“¯ ì€ì€í•˜ê²Œ ë°˜ì§ì˜€ë‹¤.</p>
                            <p>ì–´ëŠ ë‚  ë°¤, ì•„ì£¼ ì˜¤ëœ ì‹œê°„ ê·¸ ìë¦¬ë¥¼ ì§€ì¼œì˜¨ ê¸°ì™€, <strong style="color:#ea580c;">'ê²½ë³µì´'</strong>ê°€ ê¸´ ì ì—ì„œ ê¹¨ì–´ë‚¬ë‹¤.</p>
                            <p style="background:#f3f4f6; padding:20px; border-radius:15px; border-left:6px solid #9ca3af; color:#4b5563; font-style: italic;">"ìœ¼ìŒ....... ì´ê²Œ ë¬´ìŠ¨ ì†Œë¦¬ì§€?"</p>
                            <p>"ìš”ì¦˜ ê¶ê¶ì—ì„œ ì—´ë¦¬ëŠ” ìŒì•… ê³µì—° ì†Œë¦¬ì˜ˆìš”! ì°¸ ì¢‹ì£ ?"</p>
                            <p>ë‚¯ì„  ëª©ì†Œë¦¬ì— ê¹œì§ ë†€ë€ ê²½ë³µì´ê°€ ì£¼ìœ„ë¥¼ ë‘˜ëŸ¬ë³´ì, ë°˜ì§ë°˜ì§ ìœ¤ì´ ë‚˜ëŠ” ê¸°ì™€ í•˜ë‚˜ê°€ ê²½ë³µì´ë¥¼ ë°”ë¼ë³´ê³  ìˆì—ˆë‹¤.</p>
                            <p>"ë„ˆëŠ”...... ëˆ„êµ¬ë‹ˆ?"</p>
                            <p>"ì €ëŠ” 'ê¶ì´'ì˜ˆìš”. ëª‡ ë…„ ì „ ê²½ë³µê¶ì˜ ë‚¡ê³  ë§ê°€ì§„ ê¸°ì™€ë“¤ì„ ìˆ˜ë¦¬í•  ë•Œ ìƒˆë¡œ ì™”ì–´ìš”."</p>
                            <p>ê¶ì´ì˜ ë§ì— ê²½ë³µì´ê°€ ì£¼ìœ„ë¥¼ ë‘˜ëŸ¬ ë³´ë‹ˆ ìƒˆê²ƒì²˜ëŸ¼ ë°˜ì§ì´ëŠ” ê¸°ì™€ë“¤ì´ ê°€ì§€ëŸ°íˆ ë†“ì—¬ ìˆì—ˆë‹¤.</p>
                            <p>(ì¤‘ëµ)...</p>
                            <button class="read-done-btn" onclick="revealKeySentence()">
                                <i data-lucide="check" size="24" style="vertical-align:middle; margin-right:8px;"></i> ë‹¤ ì½ì—ˆì–´ìš”
                            </button>
                            <div style="height: 150px;"></div>
                        </div>
                    </div>
                    <div class="key-sentence-bar" id="key-bar">
                        <div class="key-icon"><i data-lucide="key" size="30"></i></div>
                        <div>
                            <div style="font-size:16px; font-weight:bold; color:#d97706; margin-bottom:5px;">ì¤‘ì‹¬ ë‚´ìš© ì™ì™!</div>
                            <div style="font-size:24px; font-weight:bold; color:#1f2937;">ì‹œê°„ì´ í˜ëŸ¬ë„ ë¬¸í™”ìœ ì‚°ì˜ ê°€ì¹˜ëŠ” ë³€í•˜ì§€ ì•Šìœ¼ë©°, ìš°ë¦¬ê°€ ì§€ì¼œ ë‚˜ê°€ì•¼ í•œë‹¤.</div>
                        </div>
                    </div>
                </div>
                <div id="read-step-2" class="read-step" style="display:none; height: 100%; flex-direction: column;">
                    <div class="instruction-banner">
                        <div class="step-badge">2</div>
                        <span>ì§ˆë¬¸ì— ì•Œë§ì€ ë‹µì„ ì°¾ì•„ ëˆŒëŸ¬ ë´…ì‹œë‹¤.</span>
                    </div>
                    <div class="quiz-container">
                        <div class="passage-preview">
                            <strong style="font-size:20px; color:#111;">ì—­ì‚¬ë¥¼ í’ˆì€ ê¸°ì™€, ê²½ë³µì´</strong><br><br>... (ë³¸ë¬¸ ë‚´ìš©)
                        </div>
                        <div class="question-area">
                            <div class="question-box">
                                <span class="q-tag">ë°°ê²½ ì´í•´</span>
                                <div class="q-text">1. ì´ ì´ì•¼ê¸°ì˜ ë°°ê²½ìœ¼ë¡œ ê°€ì¥ ì•Œë§ì€ ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?</div>
                                <div class="option-list">
                                    <div class="option-item" onclick="checkQuiz(this, false)">â‘  ì¡°ì„  ì‹œëŒ€ì˜ ê¶ê¶ ì—°íšŒì¥</div>
                                    <div class="option-item" onclick="checkQuiz(this, true)">â‘¡ í˜„ëŒ€ì˜ ê²½ë³µê¶ ì•¼ê°„ ê³µì—°</div>
                                    <div class="option-item" onclick="checkQuiz(this, false)">â‘¢ ì‚°ì† ë¹„ë°€ ê¸°ì™€ ë§ˆì„</div>
                                    <div class="option-item" onclick="checkQuiz(this, false)">â‘£ ì˜¤ë˜ëœ íí—ˆ</div>
                                    <div class="option-item" onclick="checkQuiz(this, false)">â‘¤ ë¯¸ë˜ì˜ ë³µì› ê³µì‚¬ í˜„ì¥</div>
                                </div>
                                <div class="explanation-box" id="quiz-explanation">
                                    <strong>ğŸ’¡ ì •ë‹µ í•´ì„¤</strong><br>ê¸€ì—ì„œ 'ìš”ì¦˜ ê¶ê¶ì—ì„œ ì—´ë¦¬ëŠ” ìŒì•… ê³µì—°', 'í™”ë ¤í•œ ì¡°ëª…'ì´ë¼ëŠ” í‘œí˜„ì´ ë‚˜ì˜¤ë¯€ë¡œ í˜„ëŒ€ì˜ ê²½ë³µê¶ì„ì„ ì•Œ ìˆ˜ ìˆì–´ìš”.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. êµ¬ì¡°ë‘ -->
        <div id="structure-screen" class="screen">
            <div class="center-wrapper">
                <div id="structure-step-0" class="structure-step" style="height: 100%; display: flex; flex-direction: column;">
                    <div class="structure-intro-bg">
                        <div class="structure-title-banner">ê¸€ì„ ë” ê¹Šê²Œ ì½ëŠ” ë¹„ë°€ ì—´ì‡  'êµ¬ì¡°ë‘'</div>
                        <div class="structure-card">
                            <div class="structure-card-header">
                                <i data-lucide="lightbulb" size="20"></i> ì˜¤ëŠ˜ì˜ ë¬¸í•´ ê³µì‹
                            </div>
                            <h2 class="structure-main-title">'ìƒì§•' ì´í•´í•˜ê¸°</h2>
                            <div class="structure-list">
                                <div class="structure-item"><span class="structure-badge">ê°œë…</span> 'ìƒì§•'ì´ë€ ë¬´ì—‡ì¼ê¹Œìš”?</div>
                                <div class="structure-item"><span class="structure-badge">ì ìš©</span> ê¸€ ì† ê¸°ì™€ë“¤ì€ ë¬´ì—‡ì„ ë‚˜íƒ€ë‚¼ê¹Œìš”?</div>
                                <div class="structure-item"><span class="structure-badge">í›ˆë ¨</span> ê¸€ ì† ìƒì§•ì„ ì´í•´í•˜ë©° ì£¼ì œë¥¼ íŒŒì•…í•´ ë³´ì•„ìš”.</div>
                            </div>
                        </div>
                        <button class="structure-start-btn" onclick="changeStep(1)">ì‹œì‘í•˜ê¸°</button>
                    </div>
                </div>
                <div id="structure-step-1" class="structure-step" style="height: 100%; display: none; flex-direction: column;">
                    <div class="instruction-banner">
                        <div class="step-badge">1</div>
                        <span>ë¹ˆì¹¸ì„ ëˆŒëŸ¬ 'ìƒì§•'ì— ëŒ€í•´ ì•Œì•„ë´…ì‹œë‹¤.</span>
                        <div class="sub-badge"><i data-lucide="lightbulb" size="16"></i> ì˜¤ëŠ˜ì˜ ë¬¸í•´ ê³µì‹: ê°œë…</div>
                    </div>
                    <div class="structure-layout">
                        <div class="concept-row">
                            <div class="concept-label">ìƒì§•</div>
                            <div class="concept-card" onclick="toggleCard(this)">
                                <span class="concept-placeholder" style="font-size:30px; color:#f97316; font-weight:bold;">?</span>
                                <div class="concept-hidden">
                                    <p style="font-size:24px; font-weight:bold; color:#374151; margin:0;">ëˆˆì— ë³´ì´ëŠ” í•˜ë‚˜ì˜ ëŒ€ìƒì—,<br>ë” í° ì˜ë¯¸ë¥¼ ë‹´ì•„ í‘œí˜„í•˜ëŠ” ë°©ë²•.</p>
                                </div>
                            </div>
                        </div>
                        <div class="concept-row" style="flex-grow:1; height:auto;">
                            <div class="concept-label">ì˜ˆì‹œ</div>
                            <div style="flex:1; display:flex; gap:20px;">
                                <div class="concept-card" onclick="toggleCard(this)" style="flex-direction:column; background:#fef9c3; border-color:#facc15; border-style:solid;">
                                    <img src="https://placehold.co/80x80?text=Dove" alt="ë¹„ë‘˜ê¸°" style="width:60px; height:60px;">
                                    <span class="concept-placeholder" style="font-size:24px; font-weight:bold; color:#ca8a04;">(ë¹„ë‘˜ê¸°) ?</span>
                                    <div class="concept-hidden"><p style="font-size:24px; font-weight:bold; color:#1d4ed8;">í‰í™”, í¬ë§</p></div>
                                </div>
                                <div class="concept-card" onclick="toggleCard(this)" style="flex-direction:column; background:#fef9c3; border-color:#facc15; border-style:solid;">
                                    <img src="https://placehold.co/80x80?text=Sprout" alt="ìƒˆì‹¹" style="width:60px; height:60px;">
                                    <span class="concept-placeholder" style="font-size:24px; font-weight:bold; color:#ca8a04;">(ìƒˆì‹¹) ?</span>
                                    <div class="concept-hidden"><p style="font-size:24px; font-weight:bold; color:#1d4ed8;">ì‹œì‘, ì„±ì¥</p></div>
                                </div>
                                <div class="concept-card" onclick="toggleCard(this)" style="flex-direction:column; background:#fef9c3; border-color:#facc15; border-style:solid;">
                                    <img src="https://placehold.co/80x80?text=Candle" alt="ì´›ë¶ˆ" style="width:60px; height:60px;">
                                    <span class="concept-placeholder" style="font-size:24px; font-weight:bold; color:#ca8a04;">(ì´›ë¶ˆ) ?</span>
                                    <div class="concept-hidden"><p style="font-size:24px; font-weight:bold; color:#1d4ed8;">í¬ë§, ì˜ì§€</p></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="structure-step-2" class="structure-step" style="height: 100%; display: none; flex-direction: column;">
                    <div class="instruction-banner">
                        <div class="step-badge">2</div>
                        <span>ë‘ ê¸°ì™€ì˜ ë‹¤ë¥¸ ì ì„ ë¹„êµí•´ ë³´ê³ , ê°ê° ë¬´ì—‡ì„ ìƒì§•í•˜ëŠ”ì§€ ì•Œì•„ë´…ì‹œë‹¤.</span>
                        <div class="sub-badge"><i data-lucide="check-circle" size="16"></i> ì ìš©</div>
                    </div>
                    <div class="structure-layout">
                        <div style="display:flex; justify-content:space-around; padding-left:150px;">
                            <div style="text-align:center;">
                                <div style="width:100px; height:100px; background:#4b5563; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto;">
                                    <img src="https://placehold.co/80x80?text=Giwa1" alt="ê²½ë³µì´" style="width:80%; height:80%;">
                                </div>
                                <h3 style="margin:10px 0; font-size:24px;">ê²½ë³µì´</h3>
                            </div>
                            <div style="text-align:center;">
                                <div style="width:100px; height:100px; background:#d97706; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto;">
                                    <img src="https://placehold.co/80x80?text=Giwa2" alt="ê¶ì´" style="width:80%; height:80%;">
                                </div>
                                <h3 style="margin:10px 0; font-size:24px;">ê¶ì´</h3>
                            </div>
                        </div>
                        <div class="compare-table">
                            <div class="compare-row"><div class="compare-header">ê²‰ëª¨ìŠµ</div><div class="compare-cell bg-orange">ì˜¤ë˜ë¨, ë‚¡ìŒ, ì€ì€í•¨</div><div class="compare-cell bg-yellow">ìƒˆê²ƒ, ë°˜ì§ë°˜ì§ ìœ¤ì´ ë‚¨</div></div>
                            <div class="compare-row"><div class="compare-header">í•œ ì¼</div>
                                <div class="compare-cell bg-orange"><button class="dropdown-btn" onclick="toggleDropdown(this)">?</button><div class="dropdown-menu"><div class="dropdown-item" onclick="selectOption(this, true)">ì˜¤ëœ ì„¸ì›” ê¶ê¶ì„ ì§€ì¼œì˜´</div><div class="dropdown-item" onclick="selectOption(this, false)">ë‚¡ì€ ê²ƒì„ ëŒ€ì‹ í•´ ìƒˆë¡œ ì˜´</div></div></div>
                                <div class="compare-cell bg-yellow"><button class="dropdown-btn" onclick="toggleDropdown(this)">?</button><div class="dropdown-menu"><div class="dropdown-item" onclick="selectOption(this, false)">ì˜¤ëœ ì„¸ì›” ê¶ê¶ì„ ì§€ì¼œì˜´</div><div class="dropdown-item" onclick="selectOption(this, true)">ë‚¡ì€ ê²ƒì„ ëŒ€ì‹ í•´ ìƒˆë¡œ ì˜´</div></div></div>
                            </div>
                            <div class="compare-row"><div class="compare-header">ìƒì§•</div>
                                <div class="compare-cell bg-orange"><button class="dropdown-btn" onclick="toggleDropdown(this)">?</button><div class="dropdown-menu"><div class="dropdown-item" onclick="selectOption(this, true)">ì „í†µê³¼ ì—­ì‚¬</div><div class="dropdown-item" onclick="selectOption(this, false)">í˜„ëŒ€ì˜ ë³€í™”ì™€ ë…¸ë ¥</div></div></div>
                                <div class="compare-cell bg-yellow"><button class="dropdown-btn" onclick="toggleDropdown(this)">?</button><div class="dropdown-menu"><div class="dropdown-item" onclick="selectOption(this, false)">ì „í†µê³¼ ì—­ì‚¬</div><div class="dropdown-item" onclick="selectOption(this, true)">í˜„ëŒ€ì˜ ë³€í™”ì™€ ë…¸ë ¥</div></div></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="structure-step-3" class="structure-step" style="height: 100%; display: none; flex-direction: column;">
                    <div class="instruction-banner">
                        <div class="step-badge">3</div>
                        <span>'ì „í†µ, ì—­ì‚¬, ë¬¸í™”ìœ ì‚°ì˜ ê°€ì¹˜'ë¥¼ ìƒì§•í•˜ëŠ” ë¬¸ì¥ì„ ì°¾ì•„ ëˆŒëŸ¬ë³´ì„¸ìš”.</span>
                        <div class="sub-badge"><i data-lucide="target" size="16"></i> í›ˆë ¨</div>
                    </div>
                    <div class="structure-layout">
                        <div style="background:white; border-radius:20px; border:2px solid #e5e7eb; padding:40px; flex-grow:1; overflow-y:auto;">
                            <div class="selectable-text">
                                <p>"ì € ì‚¬ëŒë“¤ì€ ëˆ„êµ¬ì§€? ì¡°ì„  ì™•ì¡°ëŠ” ì´ë¯¸ ì˜¤ë˜ ì „ì— ëë‚¬ëŠ”ë°......."</p>
                                <p class="sentence" onclick="checkSentence(this, false)">ê²½ë³µì´ê°€ í˜¼ë€ìŠ¤ëŸ¬ìš´ í‘œì •ìœ¼ë¡œ ì¤‘ì–¼ê±°ë ¸ë‹¤.</p>
                                <br>
                                <p class="sentence" onclick="checkSentence(this, true)">"ì™•ì¡°ëŠ” ìˆ˜ë°± ë…„ ì „ì— ëë‚¬ì§€ë§Œ, ìš°ë¦¬ ê¶ê¶ì´ ì§€ë‹Œ ê°€ì¹˜ì™€ ì—­ì‚¬ëŠ” ì•„ì§ë„ ì†Œì¤‘í•˜ê²Œ ë³´ì¡´ë˜ê³  ìˆì–´ìš”. ì§€ê¸ˆì€ ê¶ê¶ì´ ëª¨ë“  ì‚¬ëŒì—ê²Œ ì—´ë ¤ ìˆì–´ì„œ ì´ë ‡ê²Œ ë¬¸í™”ë¥¼ ì¦ê¸°ëŸ¬ ì˜¤ê¸°ë„ í•˜ê³ ìš”."</p>
                                <br>
                                <p>ê¶ê¶ì˜ ê°€ì¹˜ë¥¼ ì•Œì•„ ì£¼ëŠ” ì‚¬ëŒì´ ìˆë‹¤ëŠ” ë§ì— ê²½ë³µì´ì˜ ê°€ìŠ´ì´ ë‘ê·¼ê±°ë ¸ë‹¤.</p>
                                <br>
                                <p class="sentence" onclick="checkSentence(this, true)">'ì˜¤ëœ ì ì—ì„œ ê¹¨ì–´ ë³´ë‹ˆ ì„¸ìƒì´ ë§ì´ ë³€í–ˆêµ¬ë‚˜. ì‹œê°„ì´ í˜ëŸ¬ë„ ìš°ë¦¬ì˜ ê°€ì¹˜ë¥¼ ì•Œì•„ ì£¼ëŠ” ì´ë“¤ì´ ìˆë‹¤ë‹ˆ....... ìš°ë¦¬ ê¶ê¶ì˜ ê°€ì¹˜ê°€ ì˜¤ë˜ ì´ì–´ì§ˆ ìˆ˜ ìˆë„ë¡ ì†Œì¤‘íˆ ì§€ì¼œì•¼ê² ì–´.'</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 5. ì“°ê¸°ë‘ -->
        <div id="write-screen" class="screen">
            <div class="center-wrapper">
                <div class="instruction-banner">
                    <div class="step-badge"><i data-lucide="pen-tool" size="16"></i></div>
                    <span>ã€Œì—­ì‚¬ë¥¼ í’ˆì€ ê¸°ì™€, ê²½ë³µì´ã€ì˜ ì£¼ì œë¥¼ í•œ ë¬¸ì¥ìœ¼ë¡œ ì¨ ë´…ì‹œë‹¤.</span>
                </div>
                <div class="writing-container">
                    
                    <!-- ë²„íŠ¼ ì˜ì—­ (ì¹´ë“œ ë°– ìš°ì¸¡ ìƒë‹¨) -->
                    <div class="writing-top-buttons">
                        <button class="circle-btn orange" onclick="openModal('fulltext')" title="ê¸€ ì „ë¬¸ ë³´ê¸°">
                            <i data-lucide="book" size="24"></i>
                        </button>
                        <button class="circle-btn green" onclick="openModal('example')" title="ì˜ˆì‹œ ë‹µì•ˆ">
                            <i data-lucide="lightbulb" size="24"></i>
                        </button>
                    </div>

                    <!-- ì“°ê¸° ì¹´ë“œ (ë²„íŠ¼ ì—†ìŒ, í…ìŠ¤íŠ¸ ì˜ì—­ë§Œ) -->
                    <div class="writing-card">
                        <textarea class="writing-input" 
                            placeholder="ê²½ë³µì´â€™ì™€ â€˜ê¶ì´â€™ê°€ ìƒì§•í•˜ëŠ” ê²ƒì„ ìƒê°í•˜ë©°, ì´ì•¼ê¸°ì˜ ì£¼ì œë¥¼ ë‚˜ë§Œì˜ ë§ë¡œ ì¨ ë³´ì„¸ìš”." 
                            oninput="checkWriting(this)"></textarea>
                    </div>
                    
                    <!-- ì™„ë£Œ ë²„íŠ¼ (ì¹´ë“œ ë°– í•˜ë‹¨) -->
                    <div class="done-btn-container">
                        <button id="write-done-btn" class="writing-done-btn" disabled onclick="finishWriting()">
                            ë‹¤ í–ˆì–´ìš”
                        </button>
                    </div>

                </div>
            </div>
            <!-- ëª¨ë‹¬ -->
            <div class="modal-overlay" id="text-modal"><div class="modal-box"><button class="close-modal" onclick="closeModal('text-modal')">Ã—</button><h3>ì „ë¬¸ ë³´ê¸°</h3><p>...</p></div></div>
            <div class="modal-overlay" id="example-modal"><div class="modal-box"><button class="close-modal" onclick="closeModal('example-modal')">Ã—</button><h3>ì˜ˆì‹œ ë‹µì•ˆ</h3><div style="background:#fce7f3; padding:20px; border-radius:10px;">ì‹œê°„ì´ í˜ëŸ¬ë„ ë¬¸í™”ìœ ì‚°ì˜ ê°€ì¹˜ëŠ” ë³€í•˜ì§€ ì•Šìœ¼ë©°...</div></div></div>
        </div>

        <!-- 6. ì•„ì›ƒíŠ¸ë¡œ -->
        <div id="outro-screen" class="screen outro-bg">
            <div class="outro-icon">ğŸ‰</div>
            <div class="outro-title">ì°¸ ì˜í–ˆì–´ìš”!</div>
            <div class="outro-desc">ì˜¤ëŠ˜ì˜ í•™ìŠµì„ ëª¨ë‘ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.</div>
            <button class="replay-btn" onclick="goToTab('intro')">
                <i data-lucide="rotate-ccw" size="24"></i> ë‹¤ì‹œ ê³µë¶€í•˜ê¸°
            </button>
        </div>

    </div>

    <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="nav-controls">
        <button class="nav-btn" id="prev-btn" onclick="changeStep(-1)"><i data-lucide="chevron-left" color="#374151" size="32"></i></button>
        <div class="dots-indicator" id="dots-container"></div>
        <button class="nav-btn" id="next-btn" onclick="changeStep(1)" disabled><i data-lucide="chevron-right" color="#374151" size="32"></i></button>
    </div>

</div>

<!-- JS ì˜ì—­ -->
<script>
    lucide.createIcons();

    let currentTab = 'intro'; 
    let currentStep = 0;
    let completedSteps = {}; 
    let currentVocabCard = 1; // í˜„ì¬ ë³´ì—¬ì§€ëŠ” ì–´íœ˜ ì¹´ë“œ ë²ˆí˜¸
    const totalVocabCards = 2; // ì´ ì–´íœ˜ ì¹´ë“œ ìˆ˜

    const stepsConfig = {
        'intro': 1,
        'vocab': 2,
        'read': 2,
        'structure': 4, 
        'write': 1,
        'outro': 1 
    };

    function init() { updateUI(); }

    function goToTab(tabName) {
        currentTab = tabName;
        currentStep = 0;
        currentVocabCard = 1; // ì–´íœ˜ë‘ íƒ­ìœ¼ë¡œ ì´ë™ ì‹œ ì²« ë²ˆì§¸ ì¹´ë“œë¡œ ì´ˆê¸°í™”
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        
        if(tabName !== 'intro' && tabName !== 'outro') { 
            document.querySelector(`.tab-${tabName}`).classList.add('active'); 
        }
        updateUI();
    }

    function startApp() { goToTab('vocab'); }

    function updateUI() {
        document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.vocab-step, .read-step, .structure-step').forEach(el => el.style.display = 'none');

        const targetScreen = document.getElementById(
            currentTab === 'intro' ? 'intro-screen' : 
            currentTab === 'outro' ? 'outro-screen' : `${currentTab}-screen`
        );
        if (targetScreen) targetScreen.classList.add('active');

        if (currentTab === 'vocab') {
            document.getElementById(`vocab-step-${currentStep + 1}`).style.display = 'flex';
            if (currentStep === 0) {
                showVocabCard(currentVocabCard);
            }
        }
        else if (currentTab === 'read') document.getElementById(`read-step-${currentStep + 1}`).style.display = 'flex';
        else if (currentTab === 'structure') document.getElementById(`structure-step-${currentStep}`).style.display = 'flex'; 

        updateNavControls();
    }

    function changeStep(direction) {
        const maxSteps = stepsConfig[currentTab];
        let nextStep = currentStep + direction;

        if (nextStep >= 0 && nextStep < maxSteps) {
            currentStep = nextStep;
            updateUI();
        } else {
            if (direction > 0) {
                if (currentTab === 'vocab') goToTab('read');
                else if (currentTab === 'read') goToTab('structure');
                else if (currentTab === 'structure') goToTab('write');
                else if (currentTab === 'write') goToTab('outro');
            } else {
                if (currentTab === 'read') goToTab('vocab');
                else if (currentTab === 'structure') goToTab('read');
                else if (currentTab === 'write') goToTab('structure');
            }
        }
    }

    function updateNavControls() {
        const navContainer = document.querySelector('.nav-controls');
        const dotsContainer = document.getElementById('dots-container');
        const nextBtn = document.getElementById('next-btn');
        
        if (currentTab === 'intro' || currentTab === 'outro' || (currentTab === 'structure' && currentStep === 0)) { 
            navContainer.style.display = 'none'; 
            return; 
        }
        navContainer.style.display = 'flex';
        
        dotsContainer.innerHTML = '';
        
        if (currentTab !== 'write') {
            const totalSteps = stepsConfig[currentTab];
            const displayStepCount = currentTab === 'structure' ? totalSteps - 1 : totalSteps;
            
            for(let i=0; i<displayStepCount; i++) {
                const dot = document.createElement('div');
                const isActive = currentTab === 'structure' ? (i === currentStep - 1) : (i === currentStep);
                dot.className = `dot ${isActive ? 'active' : ''}`;
                dotsContainer.appendChild(dot);
            }
        }

        const stepKey = `${currentTab}-${currentStep}`;
        if (completedSteps[stepKey]) {
            nextBtn.disabled = false;
        } else {
            nextBtn.disabled = true;
        }
    }

    function markStepComplete() {
        const stepKey = `${currentTab}-${currentStep}`;
        completedSteps[stepKey] = true;
        updateNavControls();
    }

    function reveal(element, text, cardIndex) { 
        element.textContent = text; 
        element.classList.add('revealed'); 
        checkVocabCardCompletion(cardIndex); 
    }
    
    function checkVocabCardCompletion(cardIndex) {
        const hanjaRevealed = document.querySelectorAll(`#vocab-card-${cardIndex} .hanja-reveal.revealed`).length;
        if(hanjaRevealed >= 2) {
            // í•´ë‹¹ ì¹´ë“œ í•™ìŠµ ì™„ë£Œ ì²˜ë¦¬
            if (cardIndex === totalVocabCards) {
                // ë§ˆì§€ë§‰ ì¹´ë“œ ì™„ë£Œ ì‹œ ë‹¤í–ˆì–´ìš” ë²„íŠ¼ í™œì„±í™”
                const doneBtn = document.getElementById('vocab-done-btn');
                if(doneBtn) doneBtn.disabled = false;
                markStepComplete();
            }
        }
    }

    function showVocabCard(cardIndex) {
        document.querySelectorAll('.vocab-card').forEach(card => card.style.display = 'none');
        document.getElementById(`vocab-card-${cardIndex}`).style.display = 'flex';
        
        const prevBtn = document.getElementById('prev-word-btn');
        const nextBtn = document.getElementById('next-word-btn');
        const doneContainer = document.getElementById('vocab-done-container');

        // ì´ì „ ë²„íŠ¼ ì œì–´
        if (cardIndex > 1) {
            prevBtn.style.display = 'flex';
        } else {
            prevBtn.style.display = 'none';
        }

        // ë‹¤ìŒ ë²„íŠ¼ ë° ë‹¤í–ˆì–´ìš” ë²„íŠ¼ ì œì–´
        if (cardIndex < totalVocabCards) {
            nextBtn.innerHTML = '<i data-lucide="chevron-right" size="40"></i>';
            nextBtn.onclick = nextVocabCard;
            nextBtn.style.display = 'flex'; 
            doneContainer.style.display = 'none'; // ì²«ë²ˆì§¸ ì¹´ë“œì—ì„  ìˆ¨ê¹€
        } else {
            // ë§ˆì§€ë§‰ ì¹´ë“œ: í™”ì‚´í‘œ ìˆ¨ê¹€, ë‹¤í–ˆì–´ìš” ë²„íŠ¼ ë³´ì„
            nextBtn.style.display = 'none';
            doneContainer.style.display = 'flex';
            
            // ì´ë¯¸ ì™„ë£Œëœ ìƒíƒœì¸ì§€ í™•ì¸í•˜ì—¬ ë²„íŠ¼ ìƒíƒœ ì„¤ì •
            const hanjaRevealed = document.querySelectorAll(`#vocab-card-${cardIndex} .hanja-reveal.revealed`).length;
            const doneBtn = document.getElementById('vocab-done-btn');
            if(hanjaRevealed >= 2) {
                doneBtn.disabled = false;
            } else {
                doneBtn.disabled = true;
            }
        }
        
        // ë³„ì  ì—…ë°ì´íŠ¸
        updateVocabStars(cardIndex);
        
        lucide.createIcons(); // ì•„ì´ì½˜ ìƒˆë¡œê³ ì¹¨
    }

    function nextVocabCard() {
        if (currentVocabCard < totalVocabCards) {
            currentVocabCard++;
            showVocabCard(currentVocabCard);
        }
    }
    
    function prevVocabCard() {
        if (currentVocabCard > 1) {
            currentVocabCard--;
            showVocabCard(currentVocabCard);
        }
    }


    function updateVocabStars(completedCount) {
        const stars = document.querySelectorAll('#vocab-star-rating .star-icon');
        stars.forEach((star, index) => {
            if (index < completedCount) {
                star.classList.add('active');
            } else {
                star.classList.remove('active');
            }
        });
    }
    
    function playGame(isCorrect) {
        const arm = document.getElementById('claw-arm');
        const blank = document.querySelector('.quiz-blank');
        arm.style.height = '250px';
        setTimeout(() => {
            arm.style.height = '80px';
            setTimeout(() => {
                if(isCorrect) { blank.textContent = 'ê°€ì¹˜'; blank.style.backgroundColor = '#22c55e'; blank.style.color = 'white'; alert("ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰"); markStepComplete(); } 
                else { alert("ë‹¤ì‹œ ìƒê°í•´ë³¼ê¹Œìš”? ğŸ¤”"); }
            }, 1000);
        }, 1000);
    }
    function revealKeySentence() {
        document.getElementById('key-bar').classList.add('show');
        const textContainer = document.getElementById('passage-text');
        textContainer.scrollTo({ top: textContainer.scrollHeight, behavior: 'smooth' });
        markStepComplete();
    }
    function checkQuiz(element, isCorrect) {
        if (document.querySelector('.option-item.correct')) return;
        document.querySelectorAll('.option-item').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');
        if (isCorrect) { element.classList.add('correct'); element.classList.remove('wrong'); document.getElementById('quiz-explanation').classList.add('show'); const qBox = document.querySelector('.question-box'); setTimeout(() => { qBox.scrollTo({ top: qBox.scrollHeight, behavior: 'smooth' }); }, 100); markStepComplete(); } 
        else { element.classList.add('wrong'); setTimeout(() => { element.classList.remove('wrong'); element.classList.remove('selected'); }, 500); }
    }
    function toggleCard(element) { element.classList.add('active'); const flipped = document.querySelectorAll('#structure-step-1 .concept-card.active').length; if(flipped >= 4) markStepComplete(); }
    function toggleDropdown(btn) { const menu = btn.nextElementSibling; menu.classList.toggle('show'); }
    function selectOption(item, isCorrect) {
        const menu = item.parentElement; const btn = menu.previousElementSibling; menu.classList.remove('show');
        if(isCorrect) { btn.textContent = item.textContent; btn.classList.add('correct'); btn.style.color = '#2563eb'; btn.parentElement.style.transform = "scale(1.1)"; setTimeout(() => btn.parentElement.style.transform = "scale(1)", 200); const correctCount = document.querySelectorAll('#structure-step-2 .dropdown-btn.correct').length; if(correctCount >= 4) markStepComplete(); } 
        else { alert("ë‹¤ì‹œ í•œ ë²ˆ ìƒê°í•´ë³´ì„¸ìš”!"); }
    }
    function checkSentence(element, isCorrect) {
        if(isCorrect) { element.classList.add('selected-correct'); const correctCount = document.querySelectorAll('.sentence.selected-correct').length; if(correctCount >= 2) { alert("ì •ë‹µì…ë‹ˆë‹¤! ğŸ‘"); markStepComplete(); } } 
        else { element.classList.add('selected-wrong'); alert("ë‹¤ì‹œ ì°¾ì•„ë³¼ê¹Œìš”?"); }
    }
    function openModal(type) { if(type === 'fulltext') document.getElementById('text-modal').classList.add('active'); if(type === 'example') document.getElementById('example-modal').classList.add('active'); }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }
    
    function checkWriting(textarea) {
        const doneBtn = document.getElementById('write-done-btn');
        if(textarea.value.trim().length > 0) {
            doneBtn.disabled = false;
        } else {
            doneBtn.disabled = true;
        }
    }
    
    function finishWriting() {
        alert("ê¸€ì“°ê¸°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ì˜¤ë¥¸ìª½ í™”ì‚´í‘œë¥¼ ëˆŒëŸ¬ í•™ìŠµì„ ë§ˆë¬´ë¦¬í•˜ì„¸ìš”.");
        markStepComplete();
    }

    init();
</script>

</body>
</html>
